#include <iostream>
#include <cstdlib>
#include <ctime>
#include <limits>
using namespace std;

char board[3][3];
char playerMark, computerMark;

void resetBoard() {
    char num = '1';
    for (int i = 0; i < 3; ++i)
        for (int j = 0; j < 3; ++j)
            board[i][j] = num++;
}

void displayBoard() {
    cout << "\n";
    for (int i = 0; i < 3; i++) {
        cout << " ";
        for (int j = 0; j < 3; j++) {
            cout << board[i][j];
            if (j < 2) cout << " | ";
        }
        if (i < 2) cout << "\n---|---|---\n";
    }
    cout << "\n\n";
}

bool checkWin(char mark) {
    for (int i = 0; i < 3; i++)
        if ((board[i][0] == mark && board[i][1] == mark && board[i][2] == mark) ||
            (board[0][i] == mark && board[1][i] == mark && board[2][i] == mark))
            return true;
    return (board[0][0] == mark && board[1][1] == mark && board[2][2] == mark) ||
           (board[0][2] == mark && board[1][1] == mark && board[2][0] == mark);
}

bool isDraw() {
    for (auto& row : board)
        for (char cell : row)
            if (cell != 'X' && cell != 'O') return false;
    return true;
}

bool isValidMove(int choice) {
    int r = (choice - 1) / 3, c = (choice - 1) % 3;
    return choice >= 1 && choice <= 9 && board[r][c] != 'X' && board[r][c] != 'O';
}

void playerTurn() {
    int choice;
    while (true) {
        cout << "ğŸ‘‰ Playerì˜ í„´ (" << playerMark << "). ë²ˆí˜¸ ì„ íƒ (1-9): ";
        cin >> choice;
        if (cin.fail()) {
            cin.clear();
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            cout << "ì˜ëª»ëœ ì…ë ¥! ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n";
            continue;
        }
        if (!isValidMove(choice)) {
            cout << "ì˜ëª»ëœ ì¹¸ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì„ íƒí•˜ì„¸ìš”.\n";
            continue;
        }
        int r = (choice - 1) / 3, c = (choice - 1) % 3;
        board[r][c] = playerMark;
        break;
    }
}

bool tryMove(char mark, int& r, int& c) {
    for (int i = 1; i <= 9; ++i) {
        int row = (i - 1) / 3, col = (i - 1) % 3;
        if (board[row][col] != 'X' && board[row][col] != 'O') {
            char temp = board[row][col];
            board[row][col] = mark;
            if (checkWin(mark)) {
                board[row][col] = temp;
                r = row; c = col;
                return true;
            }
            board[row][col] = temp;
        }
    }
    return false;
}

void computerTurn() {
    cout << "ğŸ’» Computerì˜ í„´ (" << computerMark << ")...\n";
    int r, c;
    if (tryMove(computerMark, r, c) || tryMove(playerMark, r, c)) {
        board[r][c] = computerMark;
        return;
    }
    while (true) {
        int move = rand() % 9;
        r = move / 3; c = move % 3;
        if (board[r][c] != 'X' && board[r][c] != 'O') {
            board[r][c] = computerMark;
            return;
        }
    }
}

int main() {
    srand(time(0));
    int playerWins = 0, computerWins = 0, draws = 0;
    string again;

    cout << "ğŸ® í‹±íƒí†  ê²Œì„ ì‹œì‘!\n";

    // ë§ˆí¬ ì„ íƒ
    do {
        cout << "X ë˜ëŠ” O ì¤‘ ì„ íƒí•˜ì„¸ìš” (Player ë§ˆí¬): ";
        cin >> playerMark;
        playerMark = toupper(playerMark);
    } while (playerMark != 'X' && playerMark != 'O');

    computerMark = (playerMark == 'X') ? 'O' : 'X';

    do {
        resetBoard();
        bool isPlayerTurn = (playerMark == 'X');

        while (true) {
            displayBoard();
            if (isPlayerTurn) playerTurn();
            else computerTurn();

            if (checkWin(playerMark) || checkWin(computerMark) || isDraw()) break;
            isPlayerTurn = !isPlayerTurn;
        }

        // ìŠ¹íŒ¨ íŒì • ë° ì¶œë ¥
        if (checkWin(playerMark)) {
            displayBoard();
            cout << "ğŸ‰ Playerê°€ ì´ê²¼ìŠµë‹ˆë‹¤!\n";
            playerWins++;
        } else if (checkWin(computerMark)) {
            displayBoard();
            cout << "ğŸ˜ˆ Computerê°€ ì´ê²¼ìŠµë‹ˆë‹¤.\n";
            computerWins++;
        } else {
            displayBoard();
            cout << "ğŸ¤ ë¬´ìŠ¹ë¶€ì…ë‹ˆë‹¤!\n";
            draws++;
        }

        cout << "ğŸ” ë‹¤ì‹œ ì‹œì‘í• ê¹Œìš”? (y/n): ";
        cin >> again;
    } while (again == "y" || again == "Y");

    cout << "\nğŸ“Š ìµœì¢… ì „ì \n";
    cout << "Player ìŠ¹ë¦¬: " << playerWins << "íšŒ\n";
    cout << "Computer ìŠ¹ë¦¬: " << computerWins << "íšŒ\n";
    cout << "ë¬´ìŠ¹ë¶€: " << draws << "íšŒ\n";
    cout << "ğŸ‘‹ ê²Œì„ì„ ì¢…ë£Œí•©ë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!\n";
    return 0;
}
